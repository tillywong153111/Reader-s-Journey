# 读者之旅 Reader’s Journey

离线纯前端的阅读 RPG 应用（v1.5）。

## v1.5 定向修复与重构

1. 修复录入页“联网搜索长时间卡在联网中”问题，新增超时/重试/部分成功提示。
2. 强化严格一屏裁剪策略，解决录入页与面板页半截文本/残缺显示。
3. 删除独立“进度页”，改为面板页“卷轴书架主位 + 书卷详情 Sheet”直接编辑进度。
4. 新增感触时间线（新增/编辑/删除，单条上限 1000 字）。
5. 背景音乐升级为长音环境氛围双轨，默认音量下调并保留跨页淡入淡出。

## 产品定位

1. 将阅读行为游戏化，让成长“可见、可结算、可回看”。
2. 纯前端离线优先，主流程不依赖后端。
3. 核心流程：录入 -> 面板（进度与感触）-> 分享 -> 设置。

## 页面边界（v1.5）

### 保留页面
1. 录入页
2. 面板页
3. 分享页
4. 设置页

### 删除模块/页面
1. AI 书童助手
2. 下一本推荐页与导航入口
3. 独立进度页（已并入面板书卷详情）
4. 购书跳转与联盟导流

## 功能清单

### 录入页
1. 离线书库搜索（书名/作者/ISBN）。
2. 手动联网搜索（Open Library + Google Books），失败自动降级。
3. 书库选择入库 + 自编录入兜底（自编奖励 x0.7）。
4. 分类必选。
5. 搜索结果“查看更多”走 Sheet 分段加载。

### 面板页
1. 属性摘要与等级经验。
2. 卷轴书架（在读 + 已完成）。
3. 点击卷轴打开书卷详情 Sheet：
4. 可修改进度（默认不允许回退，回退需确认并按校正处理）。
5. 可新增/编辑/删除感触时间线。
6. 进度上升沿用原奖励规则结算经验/属性/技能/成就。

### 分享页
1. 生成角色卡信息（昵称、等级、优势属性、技能摘要、邀请码）。
2. 复制邀请码。
3. 复制分享文案。

### 设置页
1. 音频控制（主音频/BGM/SFX/音量/播放状态）。
2. 隐私政策入口（App 内）。
3. 数据导出、导入、重置。
4. 本机存储状态与最后保存时间。
5. 版本号、支持邮箱。
6. 明确提示“数据仅保存在本机”。

## 数值规则

1. 历史权重：前10本100%，10-50本70%，50+本30%。
2. 每日录入节奏：第1本100%，第2本80%，第3本及以上50%。
3. 新增书奖励：x1.5。
4. 自编录入奖励：x0.7。
5. 进度结算沿用既有规则（经验、属性、技能、成就）。

## 离线数据方案

1. 预置离线书库随应用打包（当前约 5 万本，中文热门优先）。
2. 用户数据本机持久化（localStorage）。
3. 支持 JSON 导出/导入，旧版本数据自动迁移到 schema v4。
4. 新增字段：`book.reflections[]`、`book.updatedAt`。
5. 不做自动云同步。

## 真实书籍数据来源

1. `doubanbook30000`（中文热门覆盖）。
2. Open Library 搜索数据快照补全。
3. Douban Top250 热门种子校验。
4. 数据索引：`src/data/catalog/index.json`。
5. 分片目录：`src/data/catalog/shards/`。

## 素材与音频

1. 字体：Noto Sans/Serif CJK SC（离线内置）。
2. 图标：项目内 SVG。
3. 音频：本地脚本生成 `src/assets/audio/*.wav`（提示音 + 长音氛围双轨 BGM）。
4. 动效：页面切换、结算反馈、Sheet 入场，支持 `prefers-reduced-motion`。
5. 许可记录：`docs/assets-license.md`。

## 技术架构

1. HTML + CSS + JavaScript（PWA）。
2. Service Worker 离线缓存。
3. 纯前端离线优先，不引入后端。
4. 联网搜索为用户手动触发，可失败降级。

## 验收标准

1. 断网下可完成录入、面板更新、分享、设置核心流程。
2. 录入页联网搜索在超时/失败后按钮必恢复可点击。
3. 常见 iPhone 尺寸下一屏无半截文本。
4. 面板可直接改进度与维护感触时间线。
5. `npm run lint`、`npm test`、`npm run build` 全通过。

## 本地运行

1. 安装依赖：`npm install`
2. 启动开发服务：`npm run dev`
3. 代码检查：`npm run lint`
4. 测试：`npm test`
5. 构建：`npm run build`
6. 预览构建产物：`npm run preview`
7. 生成/更新音频素材：`npm run assets:audio`

## 项目结构

1. `src/index.html` 页面结构
2. `src/styles.css` 样式系统与一屏裁剪规则
3. `src/app.mjs` 状态、交互、音频、Sheet 流程
4. `src/lib/state.mjs` 本地状态与迁移（schema v4）
5. `src/lib/reward-engine.mjs` 奖励结算引擎
6. `src/data/catalog/*` 离线书库与索引
7. `scripts/generate-audio-assets.mjs` 音频生成脚本
8. `docs/assets-license.md` 数据与素材许可说明
