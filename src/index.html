<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>读者之旅 Reader's Journey</title>
    <meta name="description" content="离线阅读成长应用：世界探索、录入、面板、藏书阁、设置。" />
    <meta name="theme-color" content="#0b1220" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="manifest" href="./manifest.webmanifest" />
    <link rel="icon" href="./assets/icon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="shell" id="app-shell">
      <div class="fx-layer" aria-hidden="true">
        <div class="fx-grid"></div>
        <div class="fx-stars"></div>
        <div class="fx-halo"></div>
      </div>
      <div id="game-toast-layer" class="game-toast-layer" aria-live="polite" aria-atomic="false"></div>

      <header class="app-header">
        <p class="app-kicker">Reader's Journey</p>
        <div class="title-row">
          <h1 id="app-page-title">主世界</h1>
          <div class="title-meta">
            <button id="header-share-btn" class="header-icon-btn" type="button" aria-label="打开分享证书"></button>
            <div id="header-spark-lottie" class="header-spark-lottie" aria-hidden="true"></div>
            <span id="header-level-badge" class="level-badge">Lv.1</span>
          </div>
        </div>
        <p id="app-page-subtitle">在小屋中自由探索并和设施交互，完成阅读成长任务</p>
      </header>

      <main class="app-main">
        <section
          class="view world-view active"
          data-view="world"
          data-title="主世界"
          data-subtitle="在小屋中自由探索，靠近并点击设施完成录入、成长与分享"
        >
          <article class="card world-main-card">
            <div class="world-head">
              <div class="world-status">
                <span id="world-level-chip" class="badge">Lv.1</span>
                <span id="world-book-chip" class="badge">已完成 0 本</span>
              </div>
              <div class="world-actions">
                <button id="world-entry-btn" class="world-action-btn" type="button">登记</button>
                <button id="world-share-btn" class="world-action-btn" type="button">分享</button>
              </div>
            </div>
            <div id="world-canvas" class="world-canvas" role="img" aria-label="旅者主世界探索场景"></div>
            <div class="world-hud">
              <p id="world-zone-hint" class="tip">触控地面可移动；靠近并点击设施即可交互。</p>
            </div>
          </article>
        </section>

        <section
          class="view entry-view"
          data-view="entry"
          data-title="录入"
          data-subtitle="让每次开卷，都成为一次被铭记的成长"
        >
          <article class="card entry-main-card">
            <div id="entry-quest-card" class="quest-strip"></div>
            <h2>星图书库检索</h2>
            <label>
              搜索书名 / 作者 / ISBN
              <input id="entry-search-input" type="text" placeholder="例如：思考，快与慢" />
            </label>
            <div id="entry-search-results" class="search-results"></div>
            <div class="inline-actions inline-actions-entry">
              <button id="entry-search-more-btn" class="btn-ghost" type="button">查看更多结果</button>
              <button id="entry-online-search-btn" class="btn-ghost" type="button">联网搜索</button>
              <button id="entry-custom-mode-btn" class="btn-secondary" type="button">自编录入</button>
            </div>
            <div id="entry-selection-pill" class="selection-pill hidden" aria-live="polite"></div>
            <div id="entry-selected-book" class="selection-card"></div>
            <div id="entry-custom-fields" class="field-grid two hidden">
              <label>
                书名
                <input id="entry-title-input" type="text" placeholder="自编书名" />
              </label>
              <label>
                作者
                <input id="entry-author-input" type="text" placeholder="作者（可选）" />
              </label>
              <label>
                ISBN（可选）
                <input id="entry-isbn-input" type="text" placeholder="978..." />
              </label>
              <label>
                页数
                <input id="entry-pages-input" type="number" min="1" max="4000" value="320" />
              </label>
            </div>
            <label>
              分类（必选）
              <select id="entry-category-select">
                <option value="">请选择分类</option>
                <option value="logic">逻辑</option>
                <option value="psychology">心理学</option>
                <option value="strategy">战略</option>
                <option value="literature">文学</option>
                <option value="creativity">创造</option>
                <option value="philosophy">哲学</option>
                <option value="general">通识</option>
              </select>
            </label>
            <button id="entry-add-btn" class="btn-primary" type="button">录入并结算</button>
            <p id="entry-mode-hint" class="tip"></p>
            <p id="entry-feedback" class="feedback" aria-live="polite"></p>
            <div id="entry-honor-card" class="honor-card hidden" aria-live="polite"></div>
          </article>

          <article class="card mini-card">
            <div class="card-head">
              <h2>正在阅读（3本为宜，不可贪多哦~）</h2>
              <button id="entry-books-more-btn" class="text-btn" type="button">查看全部</button>
            </div>
            <div id="entry-book-list" class="stack-list compact"></div>
          </article>
        </section>

        <section
          class="view panel-view"
          data-view="panel"
          data-title="面板"
          data-subtitle="属性与技能在此汇聚，清晰看见阅读成长"
        >
          <article class="card panel-main-card panel-overview-card">
            <div class="card-head">
              <h2>旅者属性</h2>
              <button id="panel-attributes-more-btn" class="text-btn" type="button">查看全部</button>
            </div>
            <div class="panel-core">
              <p class="panel-kicker">旅者档案</p>
              <p id="panel-level-line"></p>
              <div class="xp-track"><div id="panel-xp-fill" class="xp-fill"></div></div>
            </div>
            <div id="panel-attribute-summary-list" class="attribute-summary-list"></div>
          </article>

          <article class="card mini-card panel-summary-card panel-skills-card">
            <div class="card-head">
              <h2>技能殿堂</h2>
              <div class="head-actions">
                <button id="panel-skills-more-btn" class="text-btn" type="button">技能</button>
                <button id="panel-achievements-more-btn" class="text-btn" type="button">成就</button>
              </div>
            </div>
            <div id="panel-skill-list" class="skill-focus-list"></div>
            <div id="panel-skill-star-map" class="skill-star-map"></div>
            <p class="panel-mini-label">自动装备星环</p>
            <div id="panel-skill-auto-slots" class="skill-auto-slots"></div>
            <p class="panel-mini-label">成就摘要</p>
            <div id="panel-achievement-list" class="chip-list"></div>
          </article>
        </section>

        <section
          class="view shelf-view"
          data-view="shelf"
          data-title="藏书阁"
          data-subtitle="卷轴书架记录在读与已完成，点击即可编辑进度与感触"
        >
          <article class="card shelf-main-card panel-main-card">
            <div class="card-head">
              <h2>卷轴书架（在读 + 已完成）</h2>
              <button id="panel-shelf-more-btn" class="text-btn" type="button">查看全部</button>
            </div>
            <p class="tip">点击卷轴可展开详情，再点“查看并编辑”进入完整书卷编辑。</p>
            <div id="panel-shelf-list" class="scroll-shelf"></div>
          </article>
        </section>

        <section
          class="view share-view"
          data-view="share"
          data-title="分享"
          data-subtitle="把你的阅读轨迹，分享给下一位旅者"
        >
          <article class="card share-main-card">
            <h2>星图证书</h2>
            <label>
              昵称
              <input id="share-nickname-input" type="text" maxlength="24" placeholder="输入你的昵称" />
            </label>
            <div id="share-card" class="share-card">
              <h3 id="share-card-name">旅者001</h3>
              <p id="share-card-level"></p>
              <p id="share-card-attrs"></p>
              <p id="share-card-skills"></p>
              <p id="share-card-invite"></p>
            </div>
            <div class="inline-actions">
              <button id="share-copy-invite-btn" class="btn-secondary" type="button">复制邀请码</button>
              <button id="share-copy-btn" class="btn-primary" type="button">复制分享文案</button>
            </div>
            <p id="share-feedback" class="feedback" aria-live="polite"></p>
          </article>
        </section>

        <section
          class="view settings-view"
          data-view="settings"
          data-title="设置"
          data-subtitle="管理音频体验、数据安全与版本信息"
        >
          <article class="card settings-main-card">
            <section class="settings-block">
              <h2>音频与体验</h2>
              <p id="settings-audio-status" class="tip"></p>
              <div class="button-stack">
                <button id="settings-bgm-toggle-btn" class="btn-secondary" type="button">背景音乐：开启</button>
                <button id="settings-sfx-toggle-btn" class="btn-secondary" type="button">提示音：开启</button>
              </div>
            </section>

            <section class="settings-block">
              <h2>数据与隐私</h2>
              <p class="tip strong">数据仅保存在本机，不会自动上传到云端。</p>
              <p id="settings-storage-status" class="tip"></p>
              <p id="settings-last-saved" class="tip"></p>
              <p id="settings-catalog-meta" class="tip"></p>
              <div class="button-stack">
                <button id="settings-open-privacy-btn" class="btn-secondary" type="button">查看隐私政策</button>
                <button id="settings-export-btn" class="btn-secondary" type="button">导出数据（JSON）</button>
                <button id="settings-import-btn" class="btn-secondary" type="button">导入数据（JSON）</button>
                <button id="settings-reset-btn" class="btn-danger" type="button">重置全部数据</button>
              </div>
              <input id="settings-import-file" type="file" accept=".json,application/json" hidden />
              <p id="settings-feedback" class="feedback" aria-live="polite"></p>
            </section>

            <section class="settings-block about-block">
              <h2>版本与支持</h2>
              <p class="tip">版本号：<span id="settings-version"></span></p>
              <p class="tip">
                联系支持：
                <a href="mailto:tillywong15@gmail.com">tillywong15@gmail.com</a>
              </p>
            </section>
          </article>
        </section>
      </main>

    </div>

    <dialog id="sheet-dialog" class="sheet-dialog">
      <article class="sheet-card">
        <div class="sheet-grabber" aria-hidden="true"></div>
        <div class="sheet-head">
          <h2 id="sheet-title">详情</h2>
          <button id="sheet-close-btn" class="btn-ghost" type="button" aria-label="回到世界">回到世界</button>
        </div>
        <div id="sheet-content" class="sheet-content"></div>
      </article>
    </dialog>

    <dialog id="privacy-dialog">
      <article class="dialog-card">
        <h2>隐私政策（摘要）</h2>
        <p>
          读者之旅默认仅在本机存储你的阅读记录与设置数据，不会主动上传到远程服务器。
          你可以随时在设置页导出、导入或重置本地数据。
        </p>
        <p>
          如果未来接入云同步或第三方服务，本页面会同步更新并明确说明数据用途与处理方式。
        </p>
        <button id="privacy-close-btn" class="btn-primary" type="button">回到世界</button>
      </article>
    </dialog>

    <script src="./assets/vendor/howler.min.js"></script>
    <script src="./assets/vendor/lottie.min.js"></script>
    <script src="./assets/vendor/phaser.min.js"></script>
    <script type="module" src="./app.mjs"></script>
  </body>
</html>
